{% extends 'base.html' %}

{% block title %}{{ course.name }} | EduSystem{% endblock %}

{% block content %}
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <h1>
            <i class="fas fa-book me-2"></i>{{ course.name }}
            {% if user.student in course.students.all %}
                <span class="badge bg-success ms-2"><i class="fas fa-check me-1"></i>Inscrit</span>
            {% endif %}
        </h1>
        <div>
            {% if user.student in course.students.all %}
                <a href="#" class="btn btn-outline-danger">
                </a>
            {% else %}
                <a href="#" class="btn btn-outline-success">
                    <i class="fas fa-plus me-1"></i>S'inscrire
                </a>
            {% endif %}
        </div>
    </div>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'courses' %}">Cours</a></li>
            <li class="breadcrumb-item active">{{ course.name }}</li>
        </ol>
    </nav>
</div>

<div class="row">
    <!-- Colonne principale -->
    <div class="col-lg-8">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>À propos du cours</h5>
            </div>
            <div class="card-body">
                <p>{{ course.description }}</p>
            </div>
        </div>

        <!-- Onglets -->
        <ul class="nav nav-tabs mb-3" id="courseTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="evaluations-tab" data-bs-toggle="tab" 
                        data-bs-target="#evaluations-tab-pane" type="button" role="tab" 
                        aria-controls="evaluations-tab-pane" aria-selected="true">
                    <i class="fas fa-chart-bar me-1"></i>Évaluations
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="quizzes-tab" data-bs-toggle="tab" 
                        data-bs-target="#quizzes-tab-pane" type="button" role="tab" 
                        aria-controls="quizzes-tab-pane" aria-selected="false">
                    <i class="fas fa-question-circle me-1"></i>Quiz
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="discussions-tab" data-bs-toggle="tab" 
                        data-bs-target="#discussions-tab-pane" type="button" role="tab" 
                        aria-controls="discussions-tab-pane" aria-selected="false">
                    <i class="fas fa-comments me-1"></i>Discussions
                </button>
            </li>
        </ul>

        <div class="tab-content" id="courseTabContent">
            <!-- Tab Évaluations -->
            <div class="tab-pane fade show active" id="evaluations-tab-pane" role="tabpanel" 
                aria-labelledby="evaluations-tab" tabindex="0">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Évaluations</h5>
                        <span class="badge bg-primary">{{ course.evaluations.count }} évaluations</span>
                    </div>
                    <div class="card-body">
                        {% if course.evaluations.all %}
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Score</th>
                                            <th>Commentaire</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for evaluation in course.evaluations.all %}
                                            {% if evaluation.student == user.student %}
                                                <tr>
                                                    <td>{{ evaluation.date }}</td>
                                                    <td>
                                                        <span class="badge {% if evaluation.score >= 70 %}bg-success{% elif evaluation.score >= 50 %}bg-warning{% else %}bg-danger{% endif %}">
                                                            {{ evaluation.score }}/100
                                                        </span>
                                                    </td>
                                                    <td>{{ evaluation.comment|default:"Aucun commentaire" }}</td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>Aucune évaluation disponible pour ce cours.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Tab Quiz -->
            <div class="tab-pane fade" id="quizzes-tab-pane" role="tabpanel" 
                aria-labelledby="quizzes-tab" tabindex="0">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Quiz disponibles</h5>
                        <span class="badge bg-primary">{{ course.quizzes.count }} quiz</span>
                    </div>
                    <div class="card-body">
                        {% if course.quizzes.all %}
                            <div class="list-group">
                                {% for quiz in course.quizzes.all %}
                                    <a href="{% url 'quiz_detail' quiz.id %}" class="list-group-item list-group-item-action">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h5 class="mb-1">{{ quiz.title }}</h5>
                                            <small>{{ quiz.time_limit }} min</small>
                                        </div>
                                        <p class="mb-1">{{ quiz.description|truncatechars:100 }}</p>
                                        <div class="d-flex justify-content-between">
                                            <small class="text-muted">{{ quiz.questions.count }} questions</small>
                                                    <span class="badge bg-success">Tentatives: {{ attempt_count }}</span>
                                                    <span class="badge bg-secondary">Non tenté</span>
                                        </div>
                                    </a>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>Aucun quiz disponible pour ce cours.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Tab Discussions -->
            <div class="tab-pane fade" id="discussions-tab-pane" role="tabpanel" 
                aria-labelledby="discussions-tab" tabindex="0">
                <div class="card">
                  
                    <div class="card-body">
                        {% if course.discussions.all %}
                            <div class="list-group">
                                {% for discussion in course.discussions.all %}
                                    <a href="{% url 'discussion_detail' discussion.id %}" class="list-group-item list-group-item-action">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h5 class="mb-1">{{ discussion.title }}</h5>
                                            <small>{{ discussion.created_at|date:"d/m/Y" }}</small>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <p class="mb-1 text-muted">Par {{ discussion.created_by.user.username }}</p>
                                            <span class="badge bg-info">{{ discussion.messages.count }} messages</span>
                                        </div>
                                    </a>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>Aucune discussion pour ce cours.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
        <!-- Statistiques du cours -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Statistiques</h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between mb-3">
                    <span>Nombre d'étudiants:</span>
                    <span class="badge bg-primary">{{ course.students.count }}</span>
                </div>
                <div class="d-flex justify-content-between mb-3">
                    <span>Notes disponibles:</span>
                    <span class="badge bg-success">{{ course.notes.count }}</span>
                </div>
                <div class="d-flex justify-content-between mb-3">
                    <span>Quiz disponibles:</span>
                    <span class="badge bg-warning">{{ course.quizzes.count }}</span>
                </div>
                <div class="d-flex justify-content-between">
                    <span>Discussions actives:</span>
                    <span class="badge bg-info">{{ course.discussions.count }}</span>
                </div>
            </div>
        </div>

        <!-- Mes notes -->
        <div class="card mb-4">
           

        </div>
    </div>
</div>
{% endblock %}
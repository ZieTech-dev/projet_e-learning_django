{% extends 'base.html' %}

{% block title %}Quiz | EduSystem{% endblock %}

{% block content %}
<div class="page-header d-flex justify-content-between align-items-center">
    <h1><i class="fas fa-question-circle me-2"></i>Quiz</h1>
    <div>
        <select class="form-select" id="filterCourse">
            <option value="">Tous les cours</option>
            {% for course in user.student.courses.all %}
                <option value="{{ course.id }}">{{ course.name }}</option>
            {% endfor %}
        </select>
    </div>
</div>

<div class="row">
    {% for quiz in quizzes %}
    <div class="col-md-6 mb-4" data-course="{{ quiz.course.id }}">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">{{ quiz.title }}</h5>
                <span class="badge bg-primary">{{ quiz.questions.count }} questions</span>
            </div>
            <div class="card-body">
                <h6 class="mb-3">
                    <a href="{% url 'course_detail' quiz.course.id %}" class="text-decoration-none">
                        <i class="fas fa-book me-1"></i>{{ quiz.course.name }}
                    </a>
                </h6>
                <p class="card-text">{{ quiz.description|truncatechars:150 }}</p>
                <div class="d-flex justify-content-between align-items-center">
                    <span><i class="far fa-clock me-1"></i>{{ quiz.time_limit }} minutes</span>
                    <span class="badge bg-secondary">{{ quiz.attempts.count }} tentatives</span>
                </div>
            </div>
            <div class="d-flex justify-content-between align-items-center">
                {% if quiz.is_available %}
                    {% if quiz.user_can_attempt %}
                        <a href="{% url 'start_quiz' quiz.id %}" class="btn btn-primary">
                            <i class="fas fa-play me-1"></i>Commencer
                        </a>
                    {% else %}
                        <button class="btn btn-secondary" disabled>
                            <i class="fas fa-ban me-1"></i>Nombre max. de tentatives atteint
                        </button>
                    {% endif %}
                {% else %}
                    <button class="btn btn-secondary" disabled>
                        <i class="fas fa-lock me-1"></i>Non disponible
                    </button>
                {% endif %}
                
                {% if quiz.user_has_attempts %}
                    <a href="{% url 'quiz_results' quiz.id %}" class="btn btn-outline-secondary">
                        <i class="fas fa-history me-1"></i>Voir mes r√©sultats
                    </a>
                {% else %}
                    <span class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>Pas encore de tentative
                    </span>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% empty %}
<div class="col-12">
    <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>Aucun quiz disponible pour le moment.
    </div>
</div>
{% endfor %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const filterCourse = document.getElementById('filterCourse');
    
    filterCourse.addEventListener('change', function() {
        const courseId = this.value;
        const quizCards = document.querySelectorAll('[data-course]');
        
        quizCards.forEach(card => {
            if (courseId === '' || card.dataset.course === courseId) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });
});
</script>
{% endblock %}